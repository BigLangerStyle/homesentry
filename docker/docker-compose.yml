services:
  homesentry:
    # Build from local Dockerfile
    build:
      context: ..
      dockerfile: docker/Dockerfile
    
    # Container name for easy reference
    container_name: homesentry
    
    # Network mode: host
    # Use host network to allow container to access services on the host
    # This enables monitoring of Plex, Jellyfin, Pi-hole, etc. running on MediaServer
    # Trade-off: Container shares host network namespace (more access, less isolation)
    network_mode: host
    
    # Volume mounts
    volumes:
      # Persistent database storage
      - ../data:/app/data
      
      # Host filesystem access for disk monitoring
      # Mount host root to access all filesystems
      - /:/host:ro
      
      # Mount RAID array directly for monitoring
      - /mnt/Array:/mnt/Array:ro
      
      # Docker socket for container monitoring
      # Read-only access to Docker daemon
      - /var/run/docker.sock:/var/run/docker.sock:ro
      
      # Read-only access to host system metrics
      # These are required for collectors to monitor the actual server
      - /proc:/host/proc:ro
      - /sys:/host/sys:ro
    
    # Load environment variables from .env file
    # Create .env from .env.example before running
    env_file:
      - ../.env
    
    # Restart policy
    # unless-stopped: restart on crash, but not if manually stopped
    restart: unless-stopped
    
    # Environment variables
    environment:
      # Set timezone to match MediaServer (America/Chicago)
      - TZ=America/Chicago
